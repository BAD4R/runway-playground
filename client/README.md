# Runway API Playground (gen4_aleph + индикаторы + баланс)

Простой статический playground для Runway API со **светлой темой**, поддержкой **модели gen4_aleph**, индикацией стадий запроса («отправлен → обрабатывается → выполнен»), **автообновлением баланса кредитов** и **онлайн‑калькулятором стоимости**.

> ⚠️ **Безопасность:** это демо для локального теста. Не используйте его в продакшне и не публикуйте ключи на клиенте. Ключ хранится в `localStorage` вашего браузера.

## Возможности

- Модель **`gen4_aleph`** (видео→видео, вход **публичный URL** ролика).
- Модели для примера: `gen4_turbo` (картинка→видео), `gen4_image` (текст→картинка).
- Параметры: промпт, seed, ratio (ограниченные разрешения из документации), длительность (Aleph — 5с, Turbo — 5/10с).
- **Калькулятор стоимости** по тарифам из документации (см. Pricing). Для Aleph — **15 кредитов/сек**.
- **Баланс кредитов** из `GET /v1/organization` (обновляется раз в минуту и после каждой генерации).
- Полезные логи JSON‑ответов, fallback‑парсер для баланса и артефактов результата.
- **Статус‑бейджи**: sent / processing / done / fail и ручная **отмена задачи**.

## Быстрый старт

1. Распакуйте архив и откройте `index.html` в браузере **через локальный сервер** (например, `python -m http.server 8000` в папке проекта).
2. Введите **API ключ** (Runway Developer API) и сохраните.
3. Выберите модель и параметры, вставьте публичный URL входного медиа:
   - Aleph: поле «Видео (URL)» — длина до **5 сек**.
   - Gen‑4 Turbo: поле «Изображение (URL)».
4. Нажмите «Отправить». Следите за **статусом** и **логом**. Результат появится в блоке «Результат».

## Переключение между dev и prod API

По умолчанию playground использует dev окружение Runway API:
`https://api.dev.runwayml.com/v1`.
Чтобы перейти на продакшен, задайте переменную окружения
`RUNWAY_BASE_URL`:

```bash
export RUNWAY_BASE_URL=https://api.runwayml.com/v1
```

В браузере можно также определить `window.RUNWAY_BASE_URL` перед
подключением скриптов. После смены переменной перезапустите сервер и
перезагрузите страницу.

## Баланс кредитов

Playground вызывает `GET /v1/organization` (заголовки: `Authorization: Bearer <key>`, `X-Runway-Version`) и извлекает числовое поле, связанное со словом *credit*. Точный ключ может отличаться, поэтому реализован устойчивый поиск. Баланс показывается в кредитах и в долларах (по курсу **$0.01/кредит**).

Автообновление — **каждую минуту** и **после завершения/отмены** задачи.

## Стоимость

Используется публичная информация из **Runway API Pricing**:
- `gen4_aleph`: **15 кредитов/сек**
- `gen4_turbo`: **5 кредитов/сек**
- `gen4_image`: **5 кредитов за 720p** / **8 кредитов за 1080p** (в демо считаем 720p)

Стоимость пересчитывается при каждом изменении параметров. Перевод в USD: **1000 кредитов = $10** (т.е. `$0.01/кредит`).

## Эндпоинты (HTTP)

- Генерация видео из видео (Aleph): `POST /v1/video_to_video`
- Генерация видео из изображения (Turbo): `POST /v1/image_to_video`
- Генерация изображения из текста: `POST /v1/text_to_image`
- Детали задачи: `GET /v1/tasks/{id}`
- Отмена/удаление: `DELETE /v1/tasks/{id}`
- Инфо об организации и кредитах: `GET /v1/organization`

Все запросы требуют заголовки:
```
Authorization: Bearer <RUNWAYML_API_SECRET>
Content-Type: application/json
X-Runway-Version: 2024-11-06
```

> Замечание: Для входных файлов используется **публичный URL**. Если нужен аплоад из браузера, добавьте серверную часть для загрузки файла в ваш CDN/S3 и подставляйте полученный URL.

## Ограничения и заметки

- **CORS/секьюрность:** Некоторые окружения могут блокировать прямые вызовы из браузера. Запускайте из локального сервера и используйте ключи только для теста.
- **Aleph длительность** — 5с (согласно официальной документации). Turbo поддерживает 5/10с.
- Парсинг тела ответа: разные модели/версии API могут отличаться. В логе вы увидите весь JSON; вывод медиа пытается распознать поля `uri/url/signedUrl`.

## Где менять логику/тарифы

- Файл `main.js`, объекты `PRICING` и `RATIO_OPTIONS`.
- При появлении новых полей в API, поправьте `showOutput()` и `extractCreditBalance()`.

Удачи!